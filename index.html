<html>
    <head>
        <style>
            body{
                font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background-color: #74EBD5;
                background-image: linear-gradient(90deg, #74EBD5 0%, #9FACE6 100%);

                padding: 2vw;
                font-size: 4vh;
            }

            h1{
                font-size: 6vh;
            }

            .card{
                border-radius: 10px;
                background-color: #0093E9;
                border:solid black;
                word-wrap: break-word;
                padding: 15px;
                box-shadow: gray 10px 10px;
                margin: 15px;
                display: block;
                width:80%;

                animation-name: buildcard;
                animation-duration: 0.6s;
                animation-timing-function: ease-in-out;
            }

            .card.primary{
                background-size: 200% 100%;
                background-position: 200% 0;
                background-color: #0093E9;
                background-image: linear-gradient(160deg, #0093E9 0%, #80D0C7 100%);

                animation-name: gradient-animation-primary;
                animation-duration: 0.6s;
                animation-timing-function: ease-in-out;
            }

            .inputbox{
                background-color:linear-gradient(90deg, rgba(250, 252, 252,1) 20.5625%,rgba(248, 251, 251,1) 20.5625%,rgba(0, 234, 242,1) 80.5625%);
            }

            @keyframes gradient-animation-primary{
                0% {
                    background-position: 200% 0;
                }
                100% {
                    background-position: 0 0;
                }
            }

            .card.finish{
                background-size: 200% 100%;
                background-position: 200% 0;
                background-color: #85FFBD;
                background-image: linear-gradient(45deg, #85FFBD 0%, #FFFB7D 100%);
                animation-name: gradient-animation-finish;
                animation-duration: 0.6s;
            }

            @keyframes gradient-animation-finish{
                0% {
                    background-position: 200% 0;
                }
                100% {
                    background-position: 0 0;
                }
            }

            .card.delete{
                background-size: 200% 100%;
                background-position: 200% 0;
                background-color: #FFE53B;
                background-image: linear-gradient(147deg, #FFE53B 0%, #FF2525 74%);
                animation-name: gradient-animation-delete;
                animation-duration: 0.6s;
            }


            @keyframes gradient-animation-delete{
                0% {
                    background-position: 200% 0;
                }
                100% {
                    background-position: 0 0;
                }
            }

            
            .card.additem{
                background-size: 200% 100%;
                background-position: 200% 0;
                background-image: linear-gradient( 135deg, #92FFC0 10%, #002661 100%);
                animation-name: gradient-animation-additem;
                animation-duration: 0.6s;
            }

            @keyframes gradient-animation-additem{
                0% {
                    font-size: 0;
                    background-position: 200% 0;
                }
                50%{
                    font-size: 0;
                    background-position: 100% 0;
                }
                100% {
                    font-size: 4vh;
                    background-position: 0 0;
                }
            }

            .card.add{
                background:linear-gradient(124.72740861105774deg, rgba(50, 230, 188,1) 30.9296875%,rgba(50, 229, 187,1) 30.9296875%,rgba(255, 148, 148,1) 59.78385416666666%)
            }

            button{
                font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                border:1px solid black;
                font-size: 3vh;
                margin: 2px 0px 2px 15px;
                padding: 15px;
                border-radius: 10px;
                box-shadow: gray 10px 10px;
                display: inline-block;
            }

            button.add{
                border:none;
                box-shadow: none;
                background-color: rgba(0,0,0,0);
            }

            button.finish{
                background-color: #74EBD5;
                background-image: linear-gradient(90deg, #74EBD5 0%, #9FACE6 100%);

            }

            button.tbc{
                background-color: rgb(255, 117, 253);
            }

            button.alert{
                background-color: #FFDEE9;
                background-image: linear-gradient(0deg, #FFDEE9 0%, #B5FFFC 100%);
            }

            button.delete{
                background-color: #FFE53B;
                background-image: linear-gradient(147deg, #FFE53B 0%, #FF2525 74%);

            }

            button.all{
                background-color: #FF3CAC;
                background-image: linear-gradient(225deg, #FF3CAC 0%, #784BA0 50%, #2B86C5 100%);

            }

            button.delete-check{
                background-color: red;
            }

            button.hidden{
                border:none;
                background-color:white;
                text-shadow: 2px 2px gray;
            }

            button.primary_hidden{
                background-color: aquamarine;
                border:none;
                text-shadow: 2px 2px gray;
            }

            button.submmit{
                background-image: linear-gradient( 135deg, #F0FF00 10%, #58CFFB 100%);
            }

            button.cancel{
                background-image: linear-gradient( 135deg, #FF9D6C 10%, #BB4E75 100%);
            }

            button.primary_hidden:active{
                background-color:rgb(17, 163, 115);
            }

            button.search{
                border-radius: 10px;
                box-shadow: gray 10px 10px;
            }

            .button_div{
                transition:width 1s linear;
            }

            select{
                padding:15px;
                margin: 15px;
                border-radius: 10px;
            }

            .time-caption{
                color:gray;
                font-size: 2vh;
                text-shadow: 2px 2px gray;
                padding: 15px;
                text-decoration: none;
                margin-top: 0;
                margin-bottom: 0;
                margin-left: 15px;
                margin-right: 15px;
                animation:font-size-change-0-2 1s;
            }

            .card-text{
                user-select:none;  
            }

            .invalid-input{
                animation: invalid 1s;
                animation-timing-function: ease-in-out;
            }

            @keyframes invalid {
                0%{
                    transform:scale(1.2) translateX(-10px);
                }
                25%{
                    transform: scale(0.8) translateX(-8px);
                }
                50%{
                    transform:scale(1.1) translateX(-6px);
                }
                75%{
                    transform:scale(0.9) translateX(-4px);
                }
                100%{
                    transform: scale(1.0);
                }
            }

            @keyframes font-size-change-0-2{
                from{
                    font-size: 0;
                }
                to{
                    font-size: 2vh;
                }
            }

            input{
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                font-size: 4vh;
                padding:15px;
                margin: 15px;
                border-radius: 10px;
                box-shadow: gray 10px 10px;
                border:1px solid black;
                width: 75%;
                padding: 5px;
            }

            input.timebox{
                font-size: 3vh;
                box-shadow: gray 10px 10px;
            }

            input.expand{
                animation-name:input-expand;
                animation-duration: 0.6s;
                animation-timing-function: linear;
            }

            @keyframes input-expand {
                0%{
                    font-size: 0;
                    width:0;
                }
                50%{
                    font-size: 0;
                    width:37.5%;
                }
                100%{
                    font-size: 4vh;
                    width:75%;
                }
            }

            .footer{
                margin: 15px;
                padding: 15px;
                position: fixed;
                left: 0;
                bottom:0;
                width: 100%;
                z-index:100;
            }

            .checkbox{
            }

            .opacity-change{
                animation: from-transparent-to-solid 1s;
            }

            .font-expand{
                animation: font-size-change 1s;
                float: left;
            }

            .input-text-expand{
                animation: input-expand 2s linear;
                width:40%;
            }

            .alert-button-expand{
                animation:button-expand 2s linear;
                float:inline-end;
            }

            @keyframes from-transparent-to-solid{
                0%{
                    opacity: 0;
                }
                50%{
                    opacity: 0;
                }
                100%{
                    opacity: 1;
                }
            }

            @keyframes buildcard{
                from{
                    font-size: 0vh;
                    width:10%;
                }

                to{
                    font-size: 4vh;
                    width:80%;
                }
            }

            @keyframes font-size-change{
                from{
                    font-size: 0;
                }
                to{
                    font-size: 4vh;
                }
            }

            @keyframes input-expand{
                0%{
                    width:0;
                }
                50%{
                    width:0;
                }
                100%{
                    width:40%;
                }
            }

            @keyframes button-expand{
                0%{
                    opacity: 0;
                }
                100%{
                    opacity: 1;
                }
            }

            .overlay {   
                position: absolute;   
                top: 0px;   
                left: 0px;   
                z-index: 10001;   
                height: 100%;
                width: 100%;
                filter:alpha(opacity=60);   
                background-color: #777;   
                opacity: 0.5;   
            } 

            .card.overview{
                position: absolute;
                z-index: 10002;  
                padding:0;
                padding-left:15px;
                animation:none;
            }

            .card.overview.mid{
                top:50vw;
                left: 30vw;
                width:40vw;
                height:40vw;
                z-index: 10003;  
                font-size: 4vh;
                margin: 0;
                animation: left-to-mid 1s;
            }

            .card.overview.left{
                top:55vw;
                left: 10vw;
                width:30vw;
                height:30vw;
                font-size: 3vh;
                margin: 0;
            }

            @keyframes mid-to-right{
                0%{
                    top:50vw;
                    left: 30vw;
                    width:40vw;
                    height:40vw;
                    z-index: 10003;  
                    font-size: 4vh;
                    margin: 0;
                }
                100%{
                    top:55vw;
                    left: 60vw;
                    width:30vw;
                    height:30vw;
                    font-size: 3vh;
                    margin: 0;
                }
            }

            .card.overview.right{
                top:55vw;
                left: 60vw;
                width:30vw;
                height:30vw;
                font-size: 3vh;
                margin: 0;
                animation: mid-to-right 1s;
            }

            @keyframes left-to-mid{
                0%{
                    top:55vw;
                    left: 10vw;
                    width:30vw;
                    height:30vw;
                    font-size: 3vh;
                    margin: 0;
                }
                100%{
                    top:50vw;
                    left: 30vw;
                    width:40vw;
                    height:40vw;
                    z-index: 10003;  
                    font-size: 4vh;
                    margin: 0;
                }
            }
        </style>
    </head>
    <body style="margin-bottom: 7vh;">
        <h1><span style="color:gray;margin-bottom: 0;">Todo</span><span>List</span></h1>
        <div>
        </div>

        <div>
            <select name="State" id="state_filter" style="width:50%;font-size: 3vh;">
                <option value="All" style="background-color: gainsboro;font-size: 2vh;">All</option>
                <option value="Finished" style="background-color: greenyellow;font-size: 2vh;">Finished</option>
                <option value="Ongoing" style="background-color: aquamarine;font-size: 2vh;">Ongoing</option>
                <option value="Delete" style="background-color: #FF2525;font-size: 2vh;">Delete</option>
            </select>
        </div>
        
        
        <div id="list">
            
        </div>

        <div class="card add" id="add_btn_term">
            <button class="add" id="add" style="width:100%;">
                Add
            </button>
        </div>

        <div class="card additem" style="display: none;" id="add_item_term">
            <div style="font-weight: bold;">New Item</div>
            <div>
                <div style="font-size: 2vh;padding-left: 15px;padding-bottom: 0;color:gray">Content:</div>
                <div><input type="text" style="font-size:3vh;" class="expand" id="input"></div>
                <div style="font-size: 2vh;padding-left: 15px;padding-bottom: 0;color:red;display: none;" class="invalid-input">invalid input!</div>
            </div>
            <div>
                <div style="font-size: 2vh;padding-left: 15px;padding-bottom: 0;color:gray">Due:</div>
                <div><input type="date" id="timebox" class="timebox"/></div>
            </div>
            <div>
                <button class="submmit">Submmit</button>
                <button class="cancel">Cancel</button>
            </div>
        </div>

        <div style="display:none" id="overlay">
            <div class="overlay" id="overlay_area"></div>
        </div>

        <div class="footer">
            <button class="finish" id="finish_btn">Finish</button>
            <button class="delete" id="delete_btn">Delete</button>
            <button class="all" id="all_btn">All</button>
        </div>
    </body>
    <script>
        function $(id){
            return document.getElementById(id);
        }        

        var selected_finished = 0;

        function GetAllCards(){
            var card_list = document.querySelectorAll("div.card");
            var cards_info = [];
            card_list.forEach(function(n){
                if(n.classList.contains("delete")
                    ||n.classList.contains("primary")
                    ||n.classList.contains("finish")){
                        console.log("get");
                    cards_info.push([n.childNodes[0].innerHTML,n.childNodes[3].innerHTML]);
                }
            });
            return cards_info;
        }

        $("overlay_area").addEventListener("touchend",function(e){
            $("overlay").style.display="none";
        })

        var card_index = 0;
        var total_card_len = 0;
        function InitialCardOverview(){
            card_index = 0;
            var card_info = GetAllCards();
            var len = card_info.length;
            total_card_len = len;
            if(len==0){
                return;
            }
            console.log("init");
            console.log(card_info[len-1][0],card_info[len-1][1]);
            var middiv = document.createElement("div");
            var leftdiv = document.createElement("div");
            var rightdiv = document.createElement("div");

            var middivtitle = document.createElement("div");
            var middivtime = document.createElement("div");
            middivtime.classList.add("time-caption");
            middivtitle.innerHTML=card_info[0][0];
            middivtime.innerHTML=card_info[0][1];
            middiv.appendChild(middivtitle);
            middiv.appendChild(middivtime);
            
            console.log(card_info);

            if(len>1){
                var rightdivtitle = document.createElement("div");
                var rightdivtime = document.createElement("div");
                rightdivtime.classList.add("time-caption");
                rightdivtime.style.fontSize = "2vh";
                rightdivtitle.innerHTML=card_info[1][0];
                rightdivtime.innerHTML=card_info[1][1];
                rightdiv.appendChild(rightdivtitle);
                rightdiv.appendChild(rightdivtime);
            }
            if(len>2) {
                var leftdivtitle = document.createElement("div");
                var leftdivtime = document.createElement("div");
                leftdivtime.classList.add("time-caption");
                leftdivtime.style.fontSize = "2vh";
                leftdivtitle.innerHTML=card_info[len-1][0];
                leftdivtime.innerHTML=card_info[len-1][1];
                leftdiv.appendChild(leftdivtitle);
                leftdiv.appendChild(leftdivtime);
            }

            middiv.classList.add("card");
            middiv.classList.add("overview");
            middiv.classList.add("mid");

            leftdiv.classList.add("card");
            leftdiv.classList.add("overview");
            leftdiv.classList.add("left");

            rightdiv.classList.add("card");
            rightdiv.classList.add("overview");
            rightdiv.classList.add("right");

            var ex;
            var ey;
            middiv.addEventListener("touchstart",function(e){
                ex=e.touches[0].pageX;
                ey=e.touches[0].pageY;
                e.preventDefault();
            });

            middiv.addEventListener("touchend",function(e){
                var slide_x = e.changedTouches[0].pageX-ex;
                var slide_y = e.changedTouches[0].pageY-ey;
                if(Math.abs(slide_y)<Math.abs(slide_x)&&slide_x<0){
                    card_index = (card_index+1)%len;
                    console.log(card_index,len);
                    SwitchTo(card_index);
                }
            });

            $("overlay").appendChild(leftdiv);
            $("overlay").appendChild(middiv);
            $("overlay").appendChild(rightdiv);

            $("overlay").style.display = "block";
        }

        function SwitchTo(t){
            var card_info = GetAllCards();
            var len = card_info.length;
            total_card_len = len;
            if(len==0){
                return;
            }

            var middiv = document.createElement("div");
            var leftdiv = document.createElement("div");
            var rightdiv = document.createElement("div");

            var middivtitle = document.createElement("div");
            var middivtime = document.createElement("div");
            middivtime.classList.add("time-caption");
            middivtitle.innerHTML=card_info[t][0];
            middivtime.innerHTML=card_info[t][1];
            middiv.appendChild(middivtitle);
            middiv.appendChild(middivtime);
            
            if(len>1){
                var rightdivtitle = document.createElement("div");
                var rightdivtime = document.createElement("div");
                rightdivtime.classList.add("time-caption");
                rightdivtime.style.fontSize = "2vh";
                rightdivtitle.innerHTML=card_info[(t+1)%len][0];
                rightdivtime.innerHTML=card_info[(t+1)%len][1];
                rightdiv.appendChild(rightdivtitle);
                rightdiv.appendChild(rightdivtime);
            }
            if(len>2) {
                var leftdivtitle = document.createElement("div");
                var leftdivtime = document.createElement("div");
                leftdivtime.classList.add("time-caption");
                leftdivtime.style.fontSize = "2vh";
                leftdivtitle.innerHTML=card_info[t-1<0?len-1:t-1][0];
                leftdivtime.innerHTML=card_info[t-1<0?len-1:t-1][1];
                leftdiv.appendChild(leftdivtitle);
                leftdiv.appendChild(leftdivtime);
            }

            middiv.classList.add("card");
            middiv.classList.add("overview");
            middiv.classList.add("mid");

            leftdiv.classList.add("card");
            leftdiv.classList.add("overview");
            leftdiv.classList.add("left");

            rightdiv.classList.add("card");
            rightdiv.classList.add("overview");
            rightdiv.classList.add("right");

            var ex;
            var ey;
            middiv.addEventListener("touchstart",function(e){
                ex=e.touches[0].pageX;
                ey=e.touches[0].pageY;
                e.preventDefault();
            });

            middiv.addEventListener("touchend",function(e){
                var slide_x = e.changedTouches[0].pageX-ex;
                var slide_y = e.changedTouches[0].pageY-ey;
                if(Math.abs(slide_y)<Math.abs(slide_x)&&slide_x<0){
                    card_index = (card_index+1)%len;
                    console.log(card_index,len);
                    SwitchTo(card_index);
                }
            });

            $("overlay").removeChild($("overlay").lastChild);
            $("overlay").removeChild($("overlay").lastChild);
            $("overlay").removeChild($("overlay").lastChild);

            $("overlay").appendChild(leftdiv);
            $("overlay").appendChild(middiv);
            $("overlay").appendChild(rightdiv);
        }

        $("state_filter").addEventListener("change",function(e){
            console.log(e.target.value);
            var child_nodes = $("list").childNodes;
            var card_list = document.querySelectorAll("div.card");
            console.log(card_list);
            card_list.forEach(function(n){
                console.log(n.childNodes[1]);
                if(e.target.value=="Finished"){
                    if(n.classList.contains("finish")){
                        n.style.display="block";
                    } else {
                        n.style.display="none";
                        n.childNodes[1].firstChild.checked=false;
                    }
                }   else if(e.target.value=="Ongoing"){
                    if(n.classList.contains("primary")){
                        n.style.display="block";
                    } else {
                        n.style.display="none";
                        n.childNodes[1].firstChild.checked=false;
                    }
                }  else if(e.target.value=="Delete"){
                    if(n.classList.contains("delete")){
                        n.style.display="block";
                    } else {
                        n.style.display="none";
                        n.childNodes[1].firstChild.checked=false;
                    }
                }else {
                    console.log("ALL");
                    if(!n.classList.contains('additem')){
                        n.style.display="block";
                    }
                }
                
            })
        })

        $("finish_btn").addEventListener("touchend",function(e){
            var checkbox_list = document.querySelectorAll("input.checkbox");
            var all_finished = AllFinished(checkbox_list);
            console.log(all_finished);
            checkbox_list.forEach(function(v){
                if(v.checked){
                    var card_node = v.parentNode.parentNode;
                    if(all_finished==false){
                        if(card_node.classList.contains("delete")){
                            card_node.classList.remove("delete");
                        } else {
                            card_node.classList.remove("primary");
                        }
                        card_node.classList.add("finish");
                        card_node.firstChild.style.textDecoration = "line-through";
                    } else{
                        card_node.classList.add("primary");
                        card_node.classList.remove("finish");
                        card_node.firstChild.style.textDecoration = "none";
                    }
                    
                }
                v.checked=false;
            })
        });

        function AllFinished(checkbox_list){
            var all_finished = true;
            checkbox_list.forEach(function(v){
                if(v.checked){
                    var card_node = v.parentNode.parentNode;
                    console.log(card_node.classList.contains("finish")==false);
                    if(card_node.classList.contains("finish")==false){
                        console.log("return false");
                        all_finished = false;
                    }
                }
            });
            return all_finished;
        }

        $("delete_btn").addEventListener("touchend",function(e){
            var checkbox_list = document.querySelectorAll("input.checkbox");
            var all_delete = AllDelete(checkbox_list);
            checkbox_list.forEach(function(v){
                if(v.checked){
                    var card_node = v.parentNode.parentNode;
                    var root_node = card_node.parentNode;

                    if(card_node.classList.contains("primary")){
                        card_node.classList.remove("primary");
                        card_node.classList.add("delete");
                    } else {
                        $('list').removeChild(root_node);
                    }
                }
                v.checked=false;
            });
        });

        function AllDelete(checkbox_list){
            var all_delete = true;
            checkbox_list.forEach(function(v){
                if(v.checked){
                    var card_node = v.parentNode.parentNode;
                    if(card_node.classList.contains("delete")==false){
                        all_delete = false;
                    }
                }
            });
            return all_delete;
        }

        document.addEventListener("touchstart",function(e){
            console.log(e.target);
            if($("alerting_item")&&e.target.id!="alerting_item"){
                var temp = $("alerting_item").parentNode;
                var alerted = $("alerting_item").value;
                temp.removeChild(temp.lastChild);

                var text_node = document.createTextNode(alerted);
                temp.appendChild(text_node);
            }
        })

        $("all_btn").addEventListener("touchend",function(e){
            var checkbox_list = document.querySelectorAll("input.checkbox");
            var all_selected = AllSelected(checkbox_list);
            checkbox_list.forEach(function(v){
                console.log(v.style.display);
                if(v.parentNode.parentNode.style.display!="none"){
                    if(all_selected){
                        v.checked = false;
                    } else {
                        v.checked = true;
                    }
                }
            })
        });

        function AllSelected(checkbox_list){
            var all_selected = true;
            checkbox_list.forEach(function(v){
                if(v.parentNode.parentNode.style.display!="none"){
                    if(!v.checked){
                        all_selected = false;
                    }
                }
            });
            return all_selected;
        }

        window.onload=function(){ 
            var card_listing = localStorage.getItem("todolist");
            var listing = card_listing.split(",");
            var t=0;
            if(listing.length==1) return;
            while(t<listing.length){
                $('list').appendChild(NewCardOnload(listing[t],listing[t+1],listing[t+2],listing[t+3]));
                t=t+4;
            }
        }

        window.onbeforeunload = function () {
            window.alert("leave");
            localStorage.setItem("todolist", GetAllCardAndState());
        };

        function GetAllCardAndState(){
            var card_list = document.querySelectorAll("div.card");
            var cards_info = [];
            card_list.forEach(function(n){
                if(n.classList.contains("delete")){
                    cards_info.push([n.childNodes[0].innerHTML,n.childNodes[2].innerHTML,n.childNodes[3].innerHTML,'delete']);
                } else if(n.classList.contains("primary")){
                    cards_info.push([n.childNodes[0].innerHTML,n.childNodes[2].innerHTML,n.childNodes[3].innerHTML,'primary']);
                } else if(n.classList.contains("finish")){
                    cards_info.push([n.childNodes[0].innerHTML,n.childNodes[2].innerHTML,n.childNodes[3].innerHTML,'finish']);
                }
            });
            
            return cards_info;
        }

        function NewCardOnload(card_title,start_time,due_time,class_name){
            var card = document.createElement("div");
            card.classList.add("card");
            
            var text = document.createElement("div");
            text.classList.add('card-text');
            var text_node = document.createTextNode(card_title);
            text.appendChild(text_node);
            //text.style.display="inline-block";

            var checkboxdiv = document.createElement("div");
            var checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.style.height="4vh";
            checkbox.style.width="4vh";
            checkbox.style.display="inline-block";
            checkboxdiv.style.float = "right";
            checkbox.classList.add("checkbox");
            checkbox.classList.add("opacity-change");
            checkboxdiv.appendChild(checkbox);
            
            var starttimediv = document.createElement("div");
            starttimediv.innerHTML = start_time;
            starttimediv.classList.add('time-caption');
            
            var timediv = document.createElement("div");
            timediv.innerHTML = due_time;
            timediv.classList.add('time-caption');

            card.appendChild(text);
            card.appendChild(checkboxdiv);
            card.appendChild(starttimediv);
            card.appendChild(timediv);

            var div = document.createElement("div");
            div.appendChild(card);

            card.addEventListener("animationend",function(e){
                if(e.animationName=="buildcard"){
                    card.classList.add(class_name);
                }
            });

            var ex=0;
            var ey=0;
            card.addEventListener("touchstart",function(e){
                ex=e.touches[0].pageX;
                ey=e.touches[0].pageY;
                if(e.target.classList.contains('checkbox')){
                    console.log("check box");
                    return;
                }
                e.preventDefault();
            });

            card.addEventListener("touchmove",function(e){
                
            });

            card.addEventListener("touchend",function(e){
                var slide_x = e.changedTouches[0].pageX-ex;
                var slide_y = e.changedTouches[0].pageY-ey;
                if(Math.abs(slide_y)<Math.abs(slide_x)&&slide_x<0){
                    InitialCardOverview();
                }
            });

            var long_touch = 0;
            text.addEventListener('touchend',function(e){
                if($("alerting_item")){
                    console.log("alerting");
                    return;
                }
                this.innerHTML = '<input id="alerting_item" value="'+this.innerHTML+'">';
                e.preventDefault();
            });

            return div;
        }

        function NewCard(card_title,start_time,due_time){
            var card = document.createElement("div");
            card.classList.add("card");
            
            var text = document.createElement("div");
            text.classList.add('card-text');
            var text_node = document.createTextNode($("input").value);
            text.appendChild(text_node);
            //text.style.display="inline-block";

            var checkboxdiv = document.createElement("div");
            var checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.style.height="4vh";
            checkbox.style.width="4vh";
            checkbox.style.display="inline-block";
            checkboxdiv.style.float = "right";
            checkbox.classList.add("checkbox");
            checkbox.classList.add("opacity-change");
            checkboxdiv.appendChild(checkbox);
            
            var starttimediv = document.createElement("div");
            starttimediv.innerHTML = "<b>Start:</b>"+start_time;
            starttimediv.classList.add('time-caption');
            
            var timediv = document.createElement("div");
            timediv.innerHTML = "<b>Due:</b>"+due_time;
            timediv.classList.add('time-caption');

            card.appendChild(text);
            card.appendChild(checkboxdiv);
            card.appendChild(starttimediv);
            card.appendChild(timediv);

            var div = document.createElement("div");
            div.appendChild(card);

            card.addEventListener("animationend",function(e){
                if(e.animationName=="buildcard"){
                    if(start_time>due_time){
                        card.classList.add("delete");
                    } else {
                        card.classList.add("primary");
                    }
                }
            });

            var ex=0;
            var ey=0;
            card.addEventListener("touchstart",function(e){
                ex=e.touches[0].pageX;
                ey=e.touches[0].pageY;
                if(e.target.classList.contains('checkbox')){
                    console.log("check box");
                    return;
                }
                e.preventDefault();
            });

            card.addEventListener("touchmove",function(e){
                
            });

            card.addEventListener("touchend",function(e){
                var slide_x = e.changedTouches[0].pageX-ex;
                var slide_y = e.changedTouches[0].pageY-ey;
                if(Math.abs(slide_y)<Math.abs(slide_x)&&slide_x<0){
                    InitialCardOverview();
                }
            });

            var long_touch = 0;
            text.addEventListener('touchend',function(e){
                if($("alerting_item")){
                    console.log("alerting");
                    return;
                }
                this.innerHTML = '<input id="alerting_item" value="'+this.innerHTML+'">';
                e.preventDefault();
            });

            return div;
        }

        $("add").addEventListener('touchstart',function(e){
            if($("add_item_term").style.display=="block"){
                $("add_item_term").style.display="none";
                return;
            }
            $("add_btn_term").style.display="none";
            $("add_item_term").style.display="block";
            console.log(getTime());
            $("timebox").value=getTime();
            $("input").value="";
            
        });

        document.querySelector("button.submmit").addEventListener("touchend",function(e){
            if($("input").value.length<5){
                document.querySelector("div.invalid-input").style.display="block";
                return;
            }
            document.querySelector("div.invalid-input").style.display="none";
            $("list").insertBefore(NewCard($("input").value,getTime(),$("timebox").value),$("list").firstChild);
            $("add_item_term").style.display="none";
            $("add_btn_term").style.display="block";
        });

        console.log(document.querySelector("button.cancel"));
        document.querySelector("button.cancel").addEventListener("touchend",function(e){
            document.querySelector("div.invalid-input").style.display="none";
            document.querySelector("div.additem").style.display="none";
            $("add_btn_term").style.display="block";
        });

        function getTime(){
            var d = new Date();
            var year = d.getFullYear();
            var month = d.getMonth()+1;
            var date = d.getDate();
            var time="";
            if(month<10){
                if(date<10){
                    time = year+"-0"+month+"-0"+date;
                } else {
                    time = year+"-0"+month+"-"+date;
                }
            } else if(date<10){
                time = year+"-"+month+"-0"+date;
            } else {
                time = year+"-"+month+"-"+date;
            }
            
            return time;
        }
    </script>
</html>